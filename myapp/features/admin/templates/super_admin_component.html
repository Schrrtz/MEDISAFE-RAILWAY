<!-- Super Admin Status Component -->
<!-- This should be placed under the User Profile section in admin sidebars -->

<!-- Super Admin Status Display & Controls -->
<div id="superAdminSection" class="space-y-2 mt-3 pt-3 border-t border-white/20">
  <!-- Super Admin Mode Indicator (Compact) -->
  <div id="superAdminModeIndicator" class="hidden">
    <div class="bg-yellow-500/20 border border-yellow-400 rounded-md p-1.5">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-1">
          <i class="fas fa-crown text-yellow-400 text-xs"></i>
          <span class="text-xs font-medium text-yellow-300">SA</span>
        </div>
        <button id="exitSuperAdminBtn" 
                class="text-yellow-400 hover:text-yellow-300 transition-colors p-0.5"
                title="Exit Super Admin mode">
          <i class="fas fa-times text-xs"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Super Admin Login Button (Compact) -->
  <div id="superAdminLoginSection">
    <button id="superAdminToggleBtn" 
            class="w-full flex items-center justify-center bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-400 text-yellow-300 text-xs font-medium py-1.5 px-2 rounded-md transition-colors"
            title="Access Super Admin mode">
      <i class="fas fa-cog text-xs"></i>
    </button>
  </div>
</div>

<!-- Super Admin Modal (Global) -->
<div id="globalSuperAdminModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
    <!-- Modal Header -->
    <div class="bg-gradient-to-r from-yellow-500 to-amber-500 px-6 py-4 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <i class="fas fa-crown text-white text-xl"></i>
        <h2 class="text-xl font-bold text-white">Super Admin Access</h2>
      </div>
      <button id="closeSuperAdminBtn" class="text-white hover:bg-white/20 rounded-full p-1 transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <p class="text-gray-600 mb-6 text-sm">Enter your Super Admin credentials to unlock elevated privileges.</p>
      
      <form id="globalSuperAdminForm" class="space-y-4">
        <!-- Name Field -->
        <div>
          <label for="globalSuperAdminName" class="block text-sm font-medium text-gray-700 mb-2">Super Admin Name</label>
          <input 
            type="text" 
            id="globalSuperAdminName" 
            name="name" 
            placeholder="Enter Super Admin name"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors"
            autocomplete="off"
            required
          />
        </div>

        <!-- Password Field -->
        <div>
          <label for="globalSuperAdminPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input 
            type="password" 
            id="globalSuperAdminPassword" 
            name="password" 
            placeholder="Enter password"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors"
            autocomplete="off"
            required
          />
        </div>

        <!-- Security Warning -->
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 text-xs text-amber-800">
          <i class="fas fa-exclamation-triangle mr-2"></i>
          <strong>Security Notice:</strong> This grants elevated system privileges. Use responsibly.
        </div>

        <!-- Submit Button -->
        <button 
          type="submit" 
          class="w-full bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-600 hover:to-amber-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105"
        >
          <i class="fas fa-unlock mr-2"></i>
          Authenticate as Super Admin
        </button>

        <!-- Cancel Button -->
        <button 
          type="button" 
          class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors"
          onclick="document.getElementById('globalSuperAdminModal').classList.add('hidden'); document.getElementById('globalSuperAdminModal').classList.remove('flex');"
        >
          Cancel
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Super Admin Status Banner (Sidebar Only) -->
<div id="globalSuperAdminBanner" class="hidden p-2 bg-gradient-to-r from-yellow-500/20 to-amber-500/20 border border-yellow-400 rounded-lg mt-2">
  <div class="flex flex-col space-y-1">
    <div class="flex items-center space-x-2">
      <i class="fas fa-crown text-yellow-400 text-sm"></i>
      <span class="text-xs font-semibold text-yellow-300">Super Admin Mode</span>
    </div>
    <span class="text-xs text-yellow-200">Elevated privileges</span>
  </div>
</div>

<!-- Super Admin JavaScript Component -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get all necessary elements
  const globalSuperAdminModal = document.getElementById('globalSuperAdminModal');
  const superAdminToggleBtn = document.getElementById('superAdminToggleBtn');
  const closeSuperAdminBtn = document.getElementById('closeSuperAdminBtn');
  const globalSuperAdminForm = document.getElementById('globalSuperAdminForm');
  const exitSuperAdminBtn = document.getElementById('exitSuperAdminBtn');
  const superAdminModeIndicator = document.getElementById('superAdminModeIndicator');
  const superAdminLoginSection = document.getElementById('superAdminLoginSection');
  const globalSuperAdminBanner = document.getElementById('globalSuperAdminBanner');

  // Helper function to get CSRF token
  function getCookie(name) {
    const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return v ? v.pop() : '';
  }

  // Open modal on button click
  if (superAdminToggleBtn && globalSuperAdminModal) {
    superAdminToggleBtn.addEventListener('click', function(e) {
      e.preventDefault();
      globalSuperAdminModal.classList.remove('hidden');
      globalSuperAdminModal.classList.add('flex');
    });
  }

  // Close modal on X button
  if (closeSuperAdminBtn && globalSuperAdminModal) {
    closeSuperAdminBtn.addEventListener('click', function() {
      globalSuperAdminModal.classList.add('hidden');
      globalSuperAdminModal.classList.remove('flex');
    });
  }

  // Close modal on backdrop click
  if (globalSuperAdminModal) {
    globalSuperAdminModal.addEventListener('click', function(ev) {
      if (ev.target === globalSuperAdminModal) {
        globalSuperAdminModal.classList.add('hidden');
        globalSuperAdminModal.classList.remove('flex');
      }
    });
  }

  // Super Admin Login Form
  if (globalSuperAdminForm) {
    globalSuperAdminForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('globalSuperAdminName').value.trim();
      const password = document.getElementById('globalSuperAdminPassword').value.trim();
      
      if (!name || !password) {
        alert('Please enter both name and password');
        return;
      }

      // Show loading state
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Authenticating...';

      // Submit to backend
      fetch('/super-admin-login/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken'),
        },
        body: JSON.stringify({
          name: name,
          password: password
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Hide modal
          globalSuperAdminModal.classList.add('hidden');
          globalSuperAdminModal.classList.remove('flex');
          
          // Show Super Admin indicator and banner
          superAdminModeIndicator.classList.remove('hidden');
          superAdminLoginSection.classList.add('hidden');
          globalSuperAdminBanner.classList.remove('hidden');
          
          // Clear form
          globalSuperAdminForm.reset();
          
          // Show success message
          alert('Super Admin mode activated!');
          
          // Auto-refresh page after successful super admin login
          setTimeout(() => {
            window.location.reload();
          }, 1000); // 1 second delay to show success message
        } else {
          alert(data.message || 'Invalid Super Admin credentials');
          document.getElementById('globalSuperAdminPassword').value = '';
        }
      })
      .catch(error => {
        console.error('Super Admin Login Error:', error);
        console.error('Error message:', error.message);
        alert(error.message || 'An error occurred. Please try again.');
        document.getElementById('globalSuperAdminPassword').value = '';
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      });
    });
  }

  // Exit Super Admin mode
  if (exitSuperAdminBtn) {
    exitSuperAdminBtn.addEventListener('click', function(e) {
      e.preventDefault();
      if (!confirm('Exit Super Admin mode? You will remain logged in as regular admin.')) {
        return;
      }

      fetch('/exit-super-admin/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Hide Super Admin indicator and show login button
          superAdminModeIndicator.classList.add('hidden');
          superAdminLoginSection.classList.remove('hidden');
          
          // Hide banner
          globalSuperAdminBanner.classList.add('hidden');
          
          alert('Exited Super Admin mode. You are still logged in as admin.');
          
          // Auto-refresh page after exiting super admin
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        } else {
          alert('Failed to exit Super Admin mode');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
      });
    });
  }

  // Check Super Admin status on page load
  fetch('/check-super-admin-status/')
    .then(response => response.json())
    .then(data => {
      if (data.is_super_admin) {
        // Show Super Admin indicator
        superAdminModeIndicator.classList.remove('hidden');
        superAdminLoginSection.classList.add('hidden');
        
        // Show banner
        globalSuperAdminBanner.classList.remove('hidden');
      }
    })
    .catch(error => console.log('Could not check Super Admin status'));
});
</script>
